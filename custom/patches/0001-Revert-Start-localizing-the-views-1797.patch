From a194c5dc3b0445673100886276d21be968b79af4 Mon Sep 17 00:00:00 2001
From: elcfd <elcfd@whitetree.xyz>
Date: Wed, 14 Sep 2022 23:01:12 +0100
Subject: [PATCH 1/2] Revert "Start localizing the views (#1797)"

This reverts commit 738d6f6ec47f1300d8c792f84db5b2ceea065fcd.

Signed-off-by: elcfd <elcfd@whitetree.xyz>
---
 lib/gollum/templates/compare.mustache      | 115 ++++++++-------------
 lib/gollum/templates/error.mustache        |   4 +-
 lib/gollum/templates/history.mustache      |  63 +++++------
 lib/gollum/templates/overview.mustache     |  25 ++---
 lib/gollum/templates/pagination.mustache   |  25 +----
 lib/gollum/templates/search.mustache       |  14 +--
 lib/gollum/views/compare.rb                |   2 +-
 lib/gollum/views/helpers/locale_helpers.rb |   7 --
 lib/gollum/views/latest_changes.rb         |   2 +-
 lib/gollum/views/layout.rb                 |  14 +--
 lib/gollum/views/overview.rb               |  20 ++--
 lib/gollum/views/pagination.rb             |   2 +-
 lib/gollum/views/search.rb                 |   2 +-
 test/gollum/views/test_locale_helper.rb    | 100 +-----------------
 14 files changed, 110 insertions(+), 285 deletions(-)

diff --git a/lib/gollum/templates/compare.mustache b/lib/gollum/templates/compare.mustache
index dd80b72e..b26e84e7 100644
--- a/lib/gollum/templates/compare.mustache
+++ b/lib/gollum/templates/compare.mustache
@@ -4,84 +4,55 @@
 
     <h1 class="header-title text-center text-md-left py-4">
       <span class="f1-light text-gray-light">
-        {{t.comparing_versions_of}}
+        Comparing versions of
       </span>
       {{name}}
     </h1>
   </div>
 
 {{#message}}
-  <p>{{message}}</p>
+	<p>{{message}}</p>
 {{/message}}
 
-  <div id="compare-content">
-
-    <div class="py-4" id="actions">
-      {{#show_revert}}
-        {{#allow_editing}}
-        <form name="gollum-revert" action="{{revert_path}}/{{escaped_url_path}}/{{before}}/{{after}}" method="post" id="gollum-revert-form"></form>
-        <span class="pb-4">
-          <button
-            class="btn btn-sm"
-            onclick="$('#gollum-revert-form').submit()"
-            type="submit"
-          >
-            {{t.revert}}
-          </button>
-        </span>
-        {{/allow_editing}}
-      {{/show_revert}}
-
-      <a
-        class="btn btn-sm action-page-history"
-        href="{{history_path}}/{{escaped_url_path}}"
-      >
-        {{t.back_to_page_history}}
-      </a>
-    </div>
-
-    <div class="Box data highlight">
-      <div class="Box-header Box--condensed Box-header--gray">
-        {{path}}
-
-        <span class="px-2 float-right">
-          {{t.comparing_from}}
-        </span>
-      </div>
-
-      <table>
-        {{#lines}}
-          <tr>
-            <td class="line_numbers">{{ldln}}</td>
-            <td class="line_numbers">{{rdln}}</td>
-            <td>
-              <div class="{{class}} pl-2">{{line}}</div>
-            </td>
-          </tr>
-        {{/lines}}
-      </table>
-    </div>
-  </div>
-
-  <div class="pt-4" id="footer">
-     {{#show_revert}}
-     {{#allow_editing}}
-       <span class="pt-4">
-         <button
-           class="btn btn-sm gollum-revert-button"
-           onclick="$('#gollum-revert-form').submit()"
-           type="submit"
-         >
-           {{t.revert}}
-         </button>
-       </span>
-     {{/allow_editing}}
-     {{/show_revert}}
-
-    <div class="pt-4">
-      <a href="#">
-        {{t.back_to_top}}
-      </a>
-    </div>
-  </div>
+	<div id="compare-content">
+
+		<div class="py-4" id="actions">
+		  {{#show_revert}}
+		    {{#allow_editing}}
+				<form name="gollum-revert" action="{{revert_path}}/{{escaped_url_path}}/{{before}}/{{after}}" method="post" id="gollum-revert-form"></form>
+				<span class="pb-4">
+					<button class="btn btn-sm" type="submit" onclick="$('#gollum-revert-form').submit()">Revert Changes</button>
+				</span>
+		    {{/allow_editing}}
+		  {{/show_revert}}
+			<a href="{{history_path}}/{{escaped_url_path}}" class="btn btn-sm action-page-history">Back to Page History</a>
+		</div>
+
+	  <div class="Box data highlight">
+			<div class="Box-header Box--condensed Box-header--gray">{{path}} <span class="px-2 float-right">Comparing {{before}} to {{after}}</span></div>
+	    <table >
+	      {{#lines}}
+	        <tr>
+	          <td class="line_numbers">{{ldln}}</td>
+	          <td class="line_numbers">{{rdln}}</td>
+	          <td>
+	            <div class="{{class}} pl-2">{{line}}</div>
+	          </td>
+	        </tr>
+	      {{/lines}}
+	    </table>
+		</div>
+	</div>
+
+	<div class="pt-4" id="footer">
+	   {{#show_revert}}
+	   {{#allow_editing}}
+				<span class="pt-4"><button class="btn btn-sm gollum-revert-button" type="submit" onclick="$('#gollum-revert-form').submit()">Revert Changes</button></span>
+	   {{/allow_editing}}
+	   {{/show_revert}}
+		<div class="pt-4">
+	   <a href="#">Back to Top</a>
+		</div>
+	</div>
 </div>
+
diff --git a/lib/gollum/templates/error.mustache b/lib/gollum/templates/error.mustache
index 52c10674..9172198b 100644
--- a/lib/gollum/templates/error.mustache
+++ b/lib/gollum/templates/error.mustache
@@ -1,8 +1,8 @@
 <div id="wiki-wrapper" class="error">
   <div id="error">
-    <h1>{{t.error}}</h1>
+    <h1>Error</h1>
     <p>
       {{message}}
     </p>
   </div>
-</div>
+</div>
\ No newline at end of file
diff --git a/lib/gollum/templates/history.mustache b/lib/gollum/templates/history.mustache
index 8ea0a3dc..6d4c196b 100644
--- a/lib/gollum/templates/history.mustache
+++ b/lib/gollum/templates/history.mustache
@@ -4,7 +4,7 @@
 
   <h1 class="header-title text-center text-md-left py-4">
     <span class="f1-light text-gray-light">
-      {{t.history_for}}
+      History for
     </span>
     {{name}}
   </h1>
@@ -14,41 +14,32 @@
 
   {{>pagination}}
 
-  <form name="selection-form" id="selection-form" method="get" action="{{compare_path}}/{{escaped_url_path}}"></form>
+    <form name="selection-form" id="selection-form" method="get" action="{{compare_path}}/{{escaped_url_path}}"></form>
 
-  <div id="page-history-list" class="Box Box--condensed flex-auto">
-    <form id="version-form">
-      <ul>
-        {{#versions}}
-        <li class="Box-row border-top Box-row--hover-gray d-flex flex-items-center">
-          <span class="pr-2"><input class="checkbox" type="checkbox" name="versions[]" value="{{id}}"></span>
-          <span class="float-left col-2" id="user-icons">{{>author_template}}</span>
-          <time class="flex-auto col-1 text-gray-light" datetime="{{datetime}}" data-format="{{date_format}}">{{date}}</time>
-          <span class="flex-auto col-5">{{message}}</span>
-          <span class="pl-4 float-right">
-            <a href="{{href}}" class="btn btn-outline text-mono">{{id7}}</a>
-            <a
-              class="btn btn-outline"
-              href="{{href_page}}"
-              title="{{t.browse_in_history_description}}"
-            >
-              {{#octicon}}code{{/octicon}}
-            </a>
-          </span>
-        </li>
-        {{/versions}}
-      </ul>
-    </form>
-  </div>
+	<div id="page-history-list" class="Box Box--condensed flex-auto">
+		<form id="version-form">
+			<ul> 	
+	    	{{#versions}}
+				<li class="Box-row border-top Box-row--hover-gray d-flex flex-items-center">
+					<span class="pr-2"><input class="checkbox" type="checkbox" name="versions[]" value="{{id}}"></span>
+					<span class="float-left col-2" id="user-icons">{{>author_template}}</span>
+					<time class="flex-auto col-1 text-gray-light" datetime="{{datetime}}" data-format="{{date_format}}">{{date}}</time>
+					<span class="flex-auto col-5">{{message}}</span>
+					<span class="pl-4 float-right">
+						<a href="{{href}}" class="btn btn-outline text-mono">{{id7}}</a>
+						<a href="{{href_page}}" title="Browse the page at this point in the history" class="btn btn-outline">{{#octicon}}code{{/octicon}}</a>
+					</span>
+				</li>
+				{{/versions}}
+			</ul>
+		</form>
+	</div>
+	
 
-  <div id="footer">
-    <div class="pt-4">
-      <button
-        class="btn btn-sm action-compare-revision"
-        type="submit"
-      >
-        {{t.compare_revisions}}
-      </button>
-    </div>
-  </div>
+
+<div id="footer">
+	<div class="pt-4">
+  	<button class="btn btn-sm action-compare-revision" type="submit">Compare Revisions</button>
+	</div>
+</div>
 </div>
diff --git a/lib/gollum/templates/overview.mustache b/lib/gollum/templates/overview.mustache
index d840e0ca..f714621d 100644
--- a/lib/gollum/templates/overview.mustache
+++ b/lib/gollum/templates/overview.mustache
@@ -21,38 +21,25 @@
 						<span class="pr-2">{{{icon}}}</span>
 						<span><a href="{{url}}">{{name}}</a></span>
 						{{#allow_editing}}
-              {{#is_file}}
-                <button
-                  class="btn btn-sm float-right delete-file"
-                  data-confirm="{{t.delete_confirmation}}"
-                  data-file-path="{{file_path}}"
-                >
-                  {{#octicon}}trash{{/octicon}}
-                </button>
-              {{/is_file}}
-            {{/allow_editing}}
+							{{#is_file}}<button class="btn btn-sm float-right delete-file" data-file-path="{{file_path}}" data-confirm="Are you sure you want to delete {{name}}?">{{#octicon}}trash{{/octicon}}</button>{{/is_file}}
+						{{/allow_editing}}
 		      </li>
 				{{/files_folders}}
 	    </ul>
 		</div>
-
-
+	
+	
 {{/has_results}}
 
 {{#no_results}}
   <p id="no-results">
-    {{t.no_pages_in}}
-    <strong>{{current_path}}</strong>
-    {{t.on}}
-    <strong>{{ref}}</strong>.
+    There are no pages in <strong>{{current_path}}</strong> on <strong>{{ref}}</strong>.
   </p>
 {{/no_results}}
 
 </div>
 <div class="pt-4" id="footer">
-  <a href="#">
-    {{t.back_to_top}}
-  </a>
+	<a href="#">Back to Top</a>
 </div>
 </div>
 
diff --git a/lib/gollum/templates/pagination.mustache b/lib/gollum/templates/pagination.mustache
index 020e0976..a100f97f 100644
--- a/lib/gollum/templates/pagination.mustache
+++ b/lib/gollum/templates/pagination.mustache
@@ -1,23 +1,6 @@
-<nav class="paginate-container" aria-label="{{tt.pagination.aria.label}}">
+<nav class="paginate-container" aria-label="Pagination">
   <div class="pagination" id="pagination">
-    <a
-      aria-label="{{td.pagination.aria.previous_page}}"
-      class="previous_page {{^previous_page}}disabled{{/previous_page}}"
-      href="?page_num={{previous_page}}{{query_string}}"
-      id="prev"
-      rel="prev"
-    >
-      {{tt.pagination.previous}}
-    </a>
-
-    <a
-      aria-label="{{td.pagination.aria.next_page}}"
-      class="next_page {{^next_page}}disabled{{/next_page}}"
-      href="?page_num={{next_page}}{{query_string}}"
-      id="next"
-      rel="next"
-    >
-      {{tt.pagination.next}}
-    </a>
+    <a id="prev" href="?page_num={{previous_page}}{{query_string}}" class="previous_page {{^previous_page}}disabled{{/previous_page}}">Previous</span>
+    <a id="next" href="?page_num={{next_page}}{{query_string}}" class="next_page {{^next_page}}disabled{{/next_page}}" rel="next" aria-label="Next Page">Next</a>
   </div>
-</nav>
+</nav>
\ No newline at end of file
diff --git a/lib/gollum/templates/search.mustache b/lib/gollum/templates/search.mustache
index b8b38b41..365a6f17 100644
--- a/lib/gollum/templates/search.mustache
+++ b/lib/gollum/templates/search.mustache
@@ -4,7 +4,7 @@
 
     <h1 class="header-title text-center text-md-left py-4">
       <span class="f1-light text-gray-light">
-        {{t.search_results_for}}
+        Search results for
       </span>
       {{name}}
     </h1>
@@ -21,12 +21,7 @@
     <li class="Box-row Box-row--gray">
       <span class="Counter Counter--gray tooltipped tooltipped-w" aria-label="{{filename_count}} hits in filename - {{count}} hits in content">{{filename_count}} - {{count}}</span>&nbsp;
       <span class="text-bold"><a href="{{href}}">{{name}}</a></span>
-      <button
-        class="btn-link tooltipped tooltipped-w float-right toggle-context"
-        aria-label="{{t.aria.show_all}}"
-      >
-        {{#octicon}}search{{/octicon}}
-      </button>
+      <button class="btn-link tooltipped tooltipped-w float-right toggle-context" aria-label="Show all {{count}} hits in this page">{{#octicon}}search{{/octicon}}</button>
     </li>
 
     <div class="search-context">
@@ -34,6 +29,7 @@
       <li class="Box-row border-0"><span class="text-italic">{{.}}</span></li>
       {{/context}}
     </div>
+
   {{/results}}
   </ul>
 </div>
@@ -41,12 +37,12 @@
 
 {{#no_results}}
   <p id="no-results">
-    {{t.no_results}} <strong>{{query}}</strong>.
+    There are no results for your search <strong>{{query}}</strong>.
   </p>
 {{/no_results}}
 
 <div id="footer" class="mt-4">
-  <a class="btn" href="#">{{t.back_to_top}}</a>
+    <a class="btn" href="#">Back to Top</a>
 </div>
 
 </div>
diff --git a/lib/gollum/views/compare.rb b/lib/gollum/views/compare.rb
index ea4ee88a..83de12fd 100644
--- a/lib/gollum/views/compare.rb
+++ b/lib/gollum/views/compare.rb
@@ -6,7 +6,7 @@ module Precious
       attr_reader :page, :diff, :versions, :message, :allow_editing
 
       def title
-        [t[:comparison_of], @page.title].join(" ")
+        "Comparison of #{@page.title}"
       end
 
       def before
diff --git a/lib/gollum/views/helpers/locale_helpers.rb b/lib/gollum/views/helpers/locale_helpers.rb
index 86e25333..da15bc76 100644
--- a/lib/gollum/views/helpers/locale_helpers.rb
+++ b/lib/gollum/views/helpers/locale_helpers.rb
@@ -21,13 +21,6 @@ module Precious
         autofill I18n.t(locale_klass_name)
       end
 
-      # Returns all I18n translation strings from the root of an I18n YAML file.
-      # Otherwise, it works exactly like the `#t` method that's also defined in
-      # this file.
-      def tt
-        autofill I18n.t('.')
-      end
-
       private
 
       # Recursively looks up I18n translation values and autofills any YAML
diff --git a/lib/gollum/views/latest_changes.rb b/lib/gollum/views/latest_changes.rb
index 70fe0ed5..271391b6 100644
--- a/lib/gollum/views/latest_changes.rb
+++ b/lib/gollum/views/latest_changes.rb
@@ -9,7 +9,7 @@ module Precious
       attr_reader :wiki
 
       def title
-        t[:title]
+        "Latest Changes (Globally)"
       end
 
       def versions
diff --git a/lib/gollum/views/layout.rb b/lib/gollum/views/layout.rb
index 00d4f995..97908126 100644
--- a/lib/gollum/views/layout.rb
+++ b/lib/gollum/views/layout.rb
@@ -20,7 +20,7 @@ module Precious
       end
 
       def title
-        t[:title]
+        "Home"
       end
 
       def has_path
@@ -62,11 +62,11 @@ module Precious
       def js # custom js
         @js
       end
-
+      
       def critic_markup
         @critic_markup
       end
-
+      
       def per_page_uploads
         @per_page_uploads
       end
@@ -79,19 +79,19 @@ module Precious
       def search
         false
       end
-
+      
       def history
         false
       end
-
+      
       def overview
         false
       end
-
+      
       def latest_changes
         false
       end
-
+      
     end
   end
 end
diff --git a/lib/gollum/views/overview.rb b/lib/gollum/views/overview.rb
index d0e798a4..0c651296 100644
--- a/lib/gollum/views/overview.rb
+++ b/lib/gollum/views/overview.rb
@@ -3,11 +3,11 @@ require 'pathname'
 module Precious
   module Views
     class Overview < Layout
-      attr_reader :name, :results, :ref, :allow_editing, :newable
+      attr_reader :results, :ref, :allow_editing, :newable
       HIDDEN_PATHS = ['.gitkeep']
 
       def title
-        t[:title]
+        "Overview of #{@ref}"
       end
 
       # def editable
@@ -38,21 +38,21 @@ module Precious
         end
       end
 
-
+      
       def files_folders
         if has_results
           files_and_folders = []
-
+          
           @results.each do |result|
             result_path = result.url_path
-            result_path = result_path.sub(/^#{Regexp.escape(@path)}\//, '') unless @path.nil?
+            result_path = result_path.sub(/^#{Regexp.escape(@path)}\//, '') unless @path.nil?            
             if result_path.include?('/')
               # result contains a folder
               folder_name = result_path.split('/').first
               folder_path = @path ? "#{@path}/#{folder_name}" : folder_name
               folder_url  = "#{overview_path}/#{folder_path}/"
               files_and_folders << {name: folder_name, icon: rocticon('file-directory'), type: 'dir', url: folder_url, is_file: false}
-            elsif !HIDDEN_PATHS.include?(result_path)
+            elsif !HIDDEN_PATHS.include?(result_path) 
               file_url = page_route(result.escaped_url_path)
               files_and_folders << {name: result.filename, icon: rocticon('file'), type: 'file', url: file_url, file_path: result.escaped_url_path, is_file: true}
             end
@@ -61,7 +61,7 @@ module Precious
           files_and_folders.uniq{|f| f[:name]}.sort_by!{|f| [f[:type], f[:name]]}
         end
       end
-
+      
 
       def has_results
         !@results.empty?
@@ -70,12 +70,12 @@ module Precious
       def no_results
         @results.empty?
       end
-
+      
       def latest_changes
         true
       end
-
-
+    
+      
     end
   end
 end
diff --git a/lib/gollum/views/pagination.rb b/lib/gollum/views/pagination.rb
index 68207ec7..c7b50720 100644
--- a/lib/gollum/views/pagination.rb
+++ b/lib/gollum/views/pagination.rb
@@ -10,4 +10,4 @@ module Precious
 	    @page_num == 1 ? nil : (@page_num - 1).to_s
 	  end
   end
-end
+end
\ No newline at end of file
diff --git a/lib/gollum/views/search.rb b/lib/gollum/views/search.rb
index 4ace9e3e..05da778f 100644
--- a/lib/gollum/views/search.rb
+++ b/lib/gollum/views/search.rb
@@ -23,7 +23,7 @@ module Precious
       end
 
       def title
-        t[:title]
+        "Search results for " + @query
       end
 
       def search
diff --git a/test/gollum/views/test_locale_helper.rb b/test/gollum/views/test_locale_helper.rb
index 926f628a..a3a1d6ce 100644
--- a/test/gollum/views/test_locale_helper.rb
+++ b/test/gollum/views/test_locale_helper.rb
@@ -15,13 +15,12 @@ describe Precious::Views::LocaleHelpers do
   end
 
   def setup
-    I18n.available_locales = [:en, :de]
-    I18n.load_path = Dir[File.expand_path("test/support/locales" + "/*.yml")]
+    ::I18n.available_locales = [:en, :de]
+    ::I18n.load_path = Dir[File.expand_path("test/support/locales" + "/*.yml")]
   end
 
   def teardown
     I18n.locale = :en
-    I18n.load_path = Dir[::File.expand_path("lib/gollum/locales") + "/*.yml"]
   end
 
   let(:dummy_instance) { TestClass.new }
@@ -132,99 +131,4 @@ describe Precious::Views::LocaleHelpers do
       end
     end
   end
-
-  describe "#tt" do
-    describe "mustache usage" do
-      let(:subject) { dummy_instance.render(mustache_template) }
-
-      let(:mustache_template) { "{{ tt.test_class.hello_world }}" }
-
-      describe "in the default locale" do
-        it "returns the translation string" do
-          _(subject).must_equal "Hello world"
-        end
-      end
-
-      describe "in the configured locale" do
-        it "returns the translation string" do
-          I18n.locale = :de
-
-          _(subject).must_equal "Hallo Welt"
-        end
-      end
-
-      describe "translations with YAML arguments" do
-        let(:mustache_template) { "{{ tt.test_class.author_info.full }}" }
-
-        describe "in the default locale" do
-          it "autofills YAML arguments" do
-            _(subject).must_equal "Author J.R.R. is from Bloemfontein"
-          end
-        end
-
-        describe "in the configured locale" do
-          it "autofills YAML arguments" do
-            I18n.locale = :de
-
-            _(subject).must_equal "Autor J.R.R. ist vom Bloemfontein"
-          end
-        end
-      end
-
-      describe "translations with invalid arguments" do
-        let(:mustache_template) { "{{ tt.test_class.has_invalid_argument }}" }
-
-        it "fails gracefully with embedded error message" do
-          expected_string = "Welcome to " \
-            "[#{TestClass::NO_METHOD_MESSAGE}: no_matching_method]"
-
-          _(subject).must_equal expected_string
-        end
-      end
-
-      describe "missing translations" do
-        let(:mustache_template) {
-          "{{ tt.test_class.nested.nonexistent_key }}"
-        }
-
-        it "outputs an empty string" do
-          _(subject).must_be_empty
-        end
-      end
-    end
-
-    describe "usage" do
-      let(:subject) { dummy_instance.tt }
-
-      it "returns a hash" do
-        _(subject).must_be_kind_of Hash
-      end
-
-      it "returns all present translation keys" do
-        i18n_keys = I18n.t(".").keys
-
-        _(subject.keys).must_equal i18n_keys
-      end
-
-      it "returns nested keys" do
-        nested_keys = subject[:test_class][:author_info].keys
-
-        _(nested_keys).must_equal [:full]
-      end
-
-      describe "auto-filled YAML arguments" do
-        let(:subject) { dummy_instance.tt[:test_class][:author_info][:full] }
-
-        it "auto-fills in the default locale" do
-          _(subject).must_equal "Author J.R.R. is from Bloemfontein"
-        end
-
-        it "auto-fills in a configured locale" do
-          I18n.locale = :de
-
-          _(subject).must_equal "Autor J.R.R. ist vom Bloemfontein"
-        end
-      end
-    end
-  end
 end
-- 
2.37.3

